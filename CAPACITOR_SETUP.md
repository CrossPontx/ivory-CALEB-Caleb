# Capacitor iOS Setup Guide

This guide will help you build and run the Ivory app on iOS using Capacitor.

## Prerequisites

1. **macOS** - Required for iOS development
2. **Xcode** - Install from the Mac App Store (latest version recommended)
3. **Xcode Command Line Tools** - Run: `xcode-select --install`
4. **CocoaPods** - Run: `sudo gem install cocoapods`
5. **Node.js & Yarn** - Already installed

## Project Structure

```
nail-design-app/
├── ios/                    # Native iOS project (generated by Capacitor)
├── out/                    # Next.js build output (web assets)
├── capacitor.config.ts     # Capacitor configuration
└── package.json           # Scripts for building
```

## Development Workflow

### Option 1: Live Reload Development (Recommended for Development)

1. **Start the Next.js dev server:**
   ```bash
   yarn dev
   ```

2. **Update capacitor.config.ts** to use local server:
   ```typescript
   server: {
     url: 'http://localhost:3000',
     cleartext: true
   }
   ```

3. **Open Xcode and run:**
   ```bash
   yarn cap:open:ios
   ```

4. Select a simulator or device in Xcode and click Run (▶️)

### Option 2: Production Build (For Testing/Release)

1. **Build the Next.js app:**
   ```bash
   yarn build
   ```

2. **Sync with iOS:**
   ```bash
   yarn cap:sync
   ```

3. **Open in Xcode:**
   ```bash
   yarn cap:open:ios
   ```

4. Build and run from Xcode

### Quick Build Command

Use this single command to build and open in Xcode:
```bash
yarn ios:build
```

## Important Notes

### API Routes
Since this is a Next.js app with API routes, you have two options:

1. **Keep using Vercel/hosting** (Recommended):
   - Deploy your Next.js app to Vercel
   - Update API calls in the app to use your production URL
   - The iOS app will call your hosted APIs

2. **Use local development server**:
   - Run `yarn dev` locally
   - Configure Capacitor to point to `http://localhost:3000`
   - Only works when your Mac is running the dev server

### Camera Permissions

The app requires camera permissions. These are configured in:
- `capacitor.config.ts` - Permission descriptions
- `ios/App/App/Info.plist` - Will be auto-generated

### Environment Variables

For production builds, you'll need to:
1. Update API endpoints to use your production URLs
2. Consider using Capacitor's native storage for sensitive data
3. Environment variables won't work the same way in native builds

## Building for App Store

1. **Configure signing in Xcode:**
   - Open `ios/App/App.xcworkspace`
   - Select the App target
   - Go to "Signing & Capabilities"
   - Select your team and provisioning profile

2. **Update app info:**
   - Bundle Identifier: `com.ivory.app`
   - Display Name: `Ivory`
   - Version: Update in `ios/App/App/Info.plist`

3. **Build for release:**
   - In Xcode: Product → Archive
   - Follow App Store Connect upload process

## Troubleshooting

### "out" directory not found
Run `yarn build` first to generate the Next.js output.

### CocoaPods errors
```bash
cd ios/App
pod install
cd ../..
```

### Xcode build errors
1. Clean build folder: Xcode → Product → Clean Build Folder
2. Delete derived data: `rm -rf ~/Library/Developer/Xcode/DerivedData`
3. Re-sync: `yarn cap:sync`

### Camera not working
1. Check Info.plist has camera permissions
2. Test on a real device (simulator has limited camera support)
3. Check iOS Settings → Ivory → Camera permission

## Useful Commands

```bash
# Sync web assets to native projects
yarn cap:sync

# Open iOS project in Xcode
yarn cap:open:ios

# Run on iOS device/simulator
yarn cap:run:ios

# Build and open in one command
yarn ios:build

# Update Capacitor
yarn add @capacitor/core @capacitor/cli @capacitor/ios
npx cap sync
```

## Next Steps

1. Test the app in iOS Simulator
2. Test on a real iOS device
3. Configure proper API endpoints for production
4. Add app icons and splash screens
5. Submit to App Store

## Resources

- [Capacitor iOS Documentation](https://capacitorjs.com/docs/ios)
- [Capacitor Camera Plugin](https://capacitorjs.com/docs/apis/camera)
- [Next.js Static Export](https://nextjs.org/docs/app/building-your-application/deploying/static-exports)
